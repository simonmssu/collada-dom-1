#!/usr/bin/make
# Copyright 2006 Sony Computer Entertainment Inc.
#
# Licensed under the SCEA Shared Source License, Version 1.0 (the "License"); you may not use this 
# file except in compliance with the License. You may obtain a copy of the License at:
# http://research.scea.com/scea_shared_source_license.html
#
# Unless required by applicable law or agreed to in writing, software distributed under the License 
# is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or 
# implied. See the License for the specific language governing permissions and limitations under the 
# License. 

# target file(s)
ROOT_DIR         :=	../..
LIBRARY          := dae
OUTPUT_DIR       := $(ROOT_DIR)/lib

# definitions
include          $(ROOT_DIR)/build/makedefs.txt

# files
SRC				 := dae.cpp \
					daeArray.cpp \
					daeAtomicType.cpp \
					daeDatabase.cpp \
					daeDocument.cpp \
					daeDom.cpp \
					daeElement.cpp \
					daeError.cpp \
					daeErrorHandler.cpp \
					daeIDRef.cpp \
					daeMemorySystem.cpp \
					daeMetaAny.cpp \
					daeMetaAttribute.cpp \
					daeMetaChoice.cpp \
					daeMetaCMPolicy.cpp \
					daeMetaElement.cpp \
					daeMetaElementAttribute.cpp \
					daeMetaGroup.cpp \
					daeMetaSequence.cpp \
					daeRawResolver.cpp \
					daeSIDResolver.cpp \
					daeStringRef.cpp \
					daeStringTable.cpp \
					daeURI.cpp \
					domAny.cpp \
					daeStandardURIResolver.cpp \
					daeIOPluginCommon.cpp \
					daeRefCountedObj.cpp \
					../modules/stdErrPlugin/stdErrPlugin.cpp \
					../modules/STLDatabase/daeSTLDatabase.cpp \
					../modules/LIBXMLPlugin/daeLIBXMLPlugin.cpp \
					daeTinyXMLPlugin.cpp

INCLUDE_DIR += $(ROOT_DIR)/include
INCLUDE_DIR += $(ROOT_DIR)/include/$(COLLADA_VERSION)/

# Do we want libxml, TinyXML, or both?
ifneq ($(PLATFORM_NAME), ps3)
# On Linux, enable libxml and disable TinyXml by default
LIBXML := 1
TINYXML := 0
else
# On PS3, disable libxml and enable TinyXml by default
LIBXML := 0
TINYXML := 1
endif

ifneq ($(LIBXML), 0)
CCOPT += -D"DOM_INCLUDE_LIBXML"
INCLUDE_DIR += /usr/include/libxml2
LIBRARIES += -lxml2
endif
ifeq ($(TINYXML), 1)
CCOPT += -D"DOM_INCLUDE_TINYXML"
INCLUDE_DIR += $(ROOT_DIR)/../external-libs/tinyxml/
LIBRARIES += $(ROOT_DIR)/../external-libs/tinyxml/lib/$(PLATFORM_NAME)/libtinyxml.a
endif

ifeq ($(PLATFORM_NAME), ps3)
# On PS3, we need to be told where to find pcre
INCLUDE_DIR += $(ROOT_DIR)/../external-libs/pcre
LCOPT += -L$(ROOT_DIR)/../external-libs/pcre/lib/$(PLATFORM_NAME)

# We have no getcwd on PS3
CCOPT += -DNO_GETCWD
endif

LIBRARIES += -lpcre -lpcrecpp

# rules
include          $(ROOT_DIR)/build/makerules.txt
